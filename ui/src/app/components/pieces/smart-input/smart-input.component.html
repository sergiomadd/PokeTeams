<div class="smart-input">
  <form [formGroup]="searchForm" class="search">
    <ng-container *ngIf="label">
      <label for="">{{label}}</label>
    </ng-container>
    <ng-container *ngIf="!selected; else keep">
      <input 
      #input
      type="text" 
      placeholder="Search..." 
      formControlName="key"
      value="result"
      class="input"
      (focus)="onFocus()"
      (blur)="onBlur()"
      [ngClass]="{disabled: disabled}"
      >
    </ng-container>
    <ng-template #keep>
      <div class="input selected">
        <div class="row-start text">
          <ng-container *ngIf="selected?.icon">
            <img [attr.src]="selected?.icon" alt="" class="icon" fill>
          </ng-container>
          {{selected?.name}}
        </div>
        <ng-container *ngIf="!logged$">
          <div class="remove" (click)="removeSelected()">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512"><!--!Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2024 Fonticons, Inc.--><path d="M342.6 150.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0L192 210.7 86.6 105.4c-12.5-12.5-32.8-12.5-45.3 0s-12.5 32.8 0 45.3L146.7 256 41.4 361.4c-12.5 12.5-12.5 32.8 0 45.3s32.8 12.5 45.3 0L192 301.3 297.4 406.6c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L237.3 256 342.6 150.6z"/></svg>
          </div>
        </ng-container>
      </div>
    </ng-template>
    <ng-container *ngIf="allowNew && !selected">
      <button 
      class="new button-tertiary"
      [ngClass]="{disabled: disabled}"
      (click)="newClick()" 
      [disabled]="disabled">+</button>
    </ng-container>
  </form>
  <div 
  class="results custom-scrollbar"
  [ngClass]="{'results-visible': showOptions && results}"
  >
    <ng-container *ngIf="allowCustom; else all">
      <div 
      class="result"
      (click)="selectResult(results[0])"
      >
        <ng-container *ngIf="results[0]?.icon">
          <img [attr.src]="results[0]?.icon" alt="" class="icon" fill>
        </ng-container>
        {{results[0]?.name}}
      </div>    
      <div class="divider"></div>
      <div class="count">
        Results: {{results.length - 1}}
      </div>
      <ng-container *ngFor="let result of results; index as i">
        <ng-container *ngIf="i > 0;">
          <div 
          class="result"
          (click)="selectResult(result)"
          >
            <ng-container *ngIf="result.icon">
              <img [attr.src]="result.icon" alt="" class="icon" fill>
            </ng-container>
            {{result.name}}
          </div>
        </ng-container>
      </ng-container>
    </ng-container>
    <ng-template #all>
      <div class="count">
        Results: {{results.length}}
      </div>
      <ng-container *ngFor="let result of results; index as i">
        <div 
        class="result"
        (click)="selectResult(result)"
        >
          <ng-container *ngIf="result.icon">
            <img [attr.src]="result.icon" alt="" class="icon" fill>
          </ng-container>
          {{result.name}}
        </div>
      </ng-container>
    </ng-template>
  </div>
</div>
