<div class="settings">
  <div class="section row b-gap">
    <div class="col s-gap">
      <div class="title">
        {{'user.settings.picture-title' | translate}}
      </div>
      <div class="subtitle">
        {{'user.settings.picture_selected-subtitle' | translate}}: {{getPictureKey(user?.picture)}}
      </div>
    </div> 
    <div class="row s-gap relative">
      <ng-container *ngIf="changePictureSubmitted">
        <ng-container *ngIf="(backendError$ | async) as error">
          <span class="formFeedbackError backendErrors">{{error}}</span>
        </ng-container>
      </ng-container>
      <img src="{{user?.picture}}" alt="" class="picture">
      <div class="picture-selector">
        <button (click)="clickPictureSelector()">{{'user.settings.change-button' | translate}}</button>
        <div class="catalog-wrapper"
        [ngClass]="{catalogShow: showCatalog}"
        >
          <div class="catalog custom-scrollbar">
            <ng-container *ngFor="let pic of pictures">
              <img src="{{pic}}" alt="" class="picture animated-border" (click)="changePicture(pic)">
            </ng-container>
          </div>
        </div>
      </div>
      <ng-container *ngIf="changePictureSubmitted">
        <ng-container *ngIf="isSubmitting$ | async">
          <div class="feedback">
            <div class="pokemon-spinner"></div>
          </div>
        </ng-container>
        <ng-container *ngIf="(success$ | async) as error">
          <img src="assets/img/tick.png" alt="" class="feedback">
        </ng-container>
        <ng-container *ngIf="(backendError$ | async) as error">
          <img src="assets/img/x.png" alt="" class="feedback">
        </ng-container>
      </ng-container>
    </div>
  </div>
  <div class="section row">
    <div class="col s-gap">
      <div class="title">
        {{'user.settings.country-title' | translate}}
      </div>
      <div class="row s-gap">
        <ng-container *ngIf="user?.country">
          <img src="{{user?.country?.icon}}" alt="{{user?.country?.name}}" class="flag">
          <span class="subtitle">{{user?.country?.name}}</span>
        </ng-container>
        <ng-container *ngIf="!user?.country">
          <span class="error">{{'user.settings.country_undefined-feedback' | translate}}</span>
        </ng-container>
      </div>
    </div>
    <div class="row relative">
      <ng-container *ngIf="changeCountrySubmitted">
        <ng-container *ngIf="(backendError$ | async) as error">
          <span class="formFeedbackError backendErrors">{{error}}</span>
        </ng-container>
      </ng-container>
      <app-smart-input
      [keepSelected]="false"
      [getter]="queryService.queryCountriesCallback"
      [allGetter]="queryService.countriesAllCallback"
      (selectEvent)="changeCountry($event)"
      class="smart-input-custom-wrapper"
      ></app-smart-input>
      <ng-container *ngIf="changeCountrySubmitted">
        <ng-container *ngIf="isSubmitting$ | async">
          <div class="feedback">
            <div class="pokemon-spinner"></div>
          </div>
        </ng-container>
        <ng-container *ngIf="(success$ | async) as error">
          <img src="assets/img/tick.png" alt="" class="feedback">
        </ng-container>
        <ng-container *ngIf="(backendError$ | async) as error">
          <img src="assets/img/x.png" alt="" class="feedback">
        </ng-container>
      </ng-container>
    </div>
  </div>
  <div class="section row">
    <div class="col s-gap">
      <div class="title">
        {{'user.settings.visibility-title' | translate}}
      </div>
      <div class="subtitle">
        <ng-container *ngIf="user?.visibility">
          {{'user.settings.visibility_public-subtitle' | translate}}
        </ng-container>
        <ng-container *ngIf="!user?.visibility">
          {{'user.settings.visibility_private-subtitle' | translate}}
        </ng-container>
      </div>
    </div>
    <div class="row s-gap relative">
      <ng-container *ngIf="changeVisibilitySubmitted">
        <ng-container *ngIf="(backendError$ | async) as error">
          <span class="formFeedbackError backendErrors">{{error}}</span>
        </ng-container>
      </ng-container>
      <app-switch
      [inputState]="user?.visibility"
      [leftText]="'user.settings.visibility_public-button' | translate"
      [rightText]="'user.settings.visibility_private-button' | translate"
      (checkEvent)="changeVisibility($event)"
      ></app-switch>
      <ng-container *ngIf="changeVisibilitySubmitted">
        <ng-container *ngIf="isSubmitting$ | async">
          <div class="feedback">
            <div class="pokemon-spinner"></div>
          </div>
        </ng-container>
        <ng-container *ngIf="(success$ | async) as error">
          <img src="assets/img/tick.png" alt="" class="feedback">
        </ng-container>
        <ng-container *ngIf="(backendError$ | async) as error">
          <img src="assets/img/x.png" alt="" class="feedback">
        </ng-container>
      </ng-container>
    </div>
  </div>
  <div class="section row">
    <div class="col s-gap">
      <div class="title">
        {{'user.settings.name-title' | translate}}
      </div>
      <div class="current">
        <ng-container *ngIf="user?.name">
          <span class="subtitle">{{user?.name}}</span>
        </ng-container>
        <ng-container *ngIf="!user?.name">
          <span class="error">{{'user.settings.name_undefined-feedback' | translate}}</span>
        </ng-container>
      </div>
    </div>
    <form [formGroup]="changeNameForm" (ngSubmit)="changeName()">
      <div class="col">
        <div class="row-end b-gap relative">
          <span *ngIf="isInvalid('newName', 'changeNameForm')" class="formFeedbackError">{{getError('newName', 'changeNameForm')}}</span>
          <ng-container *ngIf="changeNameSubmitted">
            <ng-container *ngIf="(backendError$ | async) as error">
              <span class="formFeedbackError backendErrors">{{error}}</span>
            </ng-container>
          </ng-container>
          <input 
          type="text" 
          [placeholder]="'user.settings.name-input_placeholder' | translate" 
          formControlName="newName"
          [ngClass]="{controlInvalid: isInvalid('newName', 'changeNameForm')}"
          >
          <button type="submit">{{'user.settings.change-button' | translate}}</button>
          <ng-container *ngIf="changeNameSubmitted">
            <ng-container *ngIf="isSubmitting$ | async">
              <div class="feedback">
                <div class="pokemon-spinner"></div>
              </div>
            </ng-container>
            <ng-container *ngIf="(success$ | async) as error">
              <img src="assets/img/tick.png" alt="" class="feedback">
            </ng-container>
            <ng-container *ngIf="(backendError$ | async) as error">
              <img src="assets/img/x.png" alt="" class="feedback">
            </ng-container>
          </ng-container>
        </div>
      </div>
    </form>
  </div>
  <div class="section row">
    <div class="col s-gap">
      <div class="title">
        {{'user.settings.username-title' | translate}}
      </div>
      <div class="subtitle">
        {{user?.username}}
      </div>
    </div>
    <form [formGroup]="changeUserNameForm" (ngSubmit)="changeUserName()">
      <div class="col">
        <div class="row-end s-gap">
          <span *ngIf="userNameAvailable" class="formFeedbackSuccess">{{'user.settings.username_available-feedback' | translate}}</span>
          <span *ngIf="isInvalid('newUserName', 'changeUserNameForm')" class="formFeedbackError">{{getError('newUserName', 'changeUserNameForm')}}</span>
          <ng-container *ngIf="changeUserNameSubmitted">
            <ng-container *ngIf="(backendError$ | async) as error">
              <span class="formFeedbackError backendErrors">{{error}}</span>
            </ng-container>
          </ng-container>
          <input 
          type="text" 
          [placeholder]="'user.settings.username-input_placeholder' | translate" 
          formControlName="newUserName"
          [ngClass]="{controlInvalid: isInvalid('newUserName', 'changeUserNameForm')}"
          >
          <button type="submit">{{'user.settings.change-button' | translate}}</button>
          <ng-container *ngIf="changeUserNameSubmitted">
            <ng-container *ngIf="isSubmitting$ | async">
              <div class="feedback">
                <div class="pokemon-spinner"></div>
              </div>
            </ng-container>
            <ng-container *ngIf="(success$ | async) as error">
              <img src="assets/img/tick.png" alt="" class="feedback">
            </ng-container>
            <ng-container *ngIf="(backendError$ | async) as error">
              <img src="assets/img/x.png" alt="" class="feedback">
            </ng-container>
          </ng-container>
        </div>
      </div>
    </form>
  </div>
  <div class="section row">
    <div class="col s-gap">
      <div class="title">
        {{'user.settings.email-title' | translate}}
      </div>
      <div class="row s-gap">
        <div class="subtitle">
          {{email}}
        </div>
        <ng-container *ngIf="emailConfirmed">
          <div class="tooltip-wrapper">
            <img src="assets/img/confirmed.png" alt="" class="big-icon selectable">
            <app-tooltip
            [text]="'user.settings.email_verified-tooltip' | translate"
            [side]="'right'"
            ></app-tooltip>
          </div>
        </ng-container>
      </div>
      <ng-container *ngIf="!emailConfirmed">
        <div class="col s-gap">
          <div class="formFeedbackError">
            {{'user.settings.email_not_verified-feedback' | translate}}
          </div>
        </div>
      </ng-container>
    </div>
    <div class="col b-gap">
      <form [formGroup]="changeEmailForm" (ngSubmit)="changeEmail()">
        <div class="row s-gap">
          <span *ngIf="isInvalid('newEmail', 'changeEmailForm')" class="formFeedbackError">{{getError('newEmail', 'changeEmailForm')}}</span>
          <ng-container *ngIf="changeEmailSubmitted">
            <ng-container *ngIf="(backendError$ | async) as error">
              <span class="formFeedbackError backendErrors">{{error}}</span>
            </ng-container>
          </ng-container>
          <input 
          type="text" 
          [placeholder]="'user.settings.email-input_placeholder' | translate" 
          formControlName="newEmail"
          [ngClass]="{controlInvalid: isInvalid('newEmail', 'changeEmailForm')}"
          >
          <button type="submit">{{'user.settings.change-button' | translate}}</button>
          <ng-container *ngIf="changeEmailSubmitted">
            <ng-container *ngIf="isSubmitting$ | async">
              <div class="feedback">
                <div class="pokemon-spinner"></div>
              </div>
            </ng-container>
            <ng-container *ngIf="(success$ | async) as error">
              <img src="assets/img/tick.png" alt="" class="feedback">
            </ng-container>
            <ng-container *ngIf="(backendError$ | async) as error">
              <img src="assets/img/x.png" alt="" class="feedback">
            </ng-container>
          </ng-container>
        </div>
      </form>
      <ng-container *ngIf="!emailConfirmed">
        <div class="row-end s-gap relative">
          <ng-container *ngIf="sendEmailVerificationCodeSubmitted">
            <ng-container *ngIf="(backendError$ | async) as error">
              <span class="formFeedbackError backendErrors">{{error}}</span>
            </ng-container>
          </ng-container>
          <button (click)="sendEmailVerificationCode()">{{'user.settings.email_verification-button' | translate}}</button>
          <ng-container *ngIf="sendEmailVerificationCodeSubmitted">
            <ng-container *ngIf="isSubmitting$ | async">
              <div class="feedback">
                <div class="pokemon-spinner"></div>
              </div>
            </ng-container>
            <ng-container *ngIf="(success$ | async) as error">
              <img src="assets/img/tick.png" alt="" class="feedback">
            </ng-container>
            <ng-container *ngIf="(backendError$ | async) as error">
              <img src="assets/img/x.png" alt="" class="feedback">
            </ng-container>
          </ng-container>
        </div>
      </ng-container>
    </div>
  </div>
  <div class="section row">
    <div class="col s-gap">
      <div class="title">
        {{'user.settings.password-title' | translate}}
      </div>
      <div class="subtitle">
        {{'user.settings.password-subtitle' | translate}}
      </div>
    </div>
    <form class="row b-gap" [formGroup]="changePasswordForm" (ngSubmit)="changePassword()">
      <ng-container *ngIf="changePasswordSubmitted">
        <ng-container *ngIf="(backendError$ | async) as error">
          <span class="formFeedbackError backendErrors">{{error}}</span>
        </ng-container>
      </ng-container>
      <div class="col">
        <input 
        type="password" 
        [placeholder]="'user.settings.current_password-input_placeholder' | translate" 
        formControlName="currentPassword"
        [ngClass]="{controlInvalid: isInvalid('currentPassword', 'changePasswordForm')}"
        >
        <div *ngIf="isInvalid('currentPassword', 'changePasswordForm')" class="formFeedbackError">{{getError('currentPassword', 'changePasswordForm')}}</div>
      </div>
      <div class="col">
        <input 
        type="password" 
        [placeholder]="'user.settings.new_password-input_placeholder' | translate" 
        formControlName="password"
        [ngClass]="{controlInvalid: isInvalid('password', 'changePasswordForm')}"
        >
        <div *ngIf="isInvalid('password', 'changePasswordForm')" class="formFeedbackError">{{getError('password', 'changePasswordForm')}}</div>
      </div>
      <div class="col">
        <input 
        type="password" 
        [placeholder]="'user.settings.new_repeat_password-input_placeholder' | translate" 
        formControlName="confirmPassword"
        [ngClass]="{controlInvalid: isInvalid('confirmPassword', 'changePasswordForm')}"
        >
        <div *ngIf="isInvalid('confirmPassword', 'changePasswordForm')" class="formFeedbackError">{{getError('confirmPassword', 'changePasswordForm')}}</div>
      </div>
      <button type="submit">{{'user.settings.change-button' | translate}}</button>
      <ng-container *ngIf="changePasswordSubmitted">
        <ng-container *ngIf="isSubmitting$ | async">
          <div class="feedback">
            <div class="pokemon-spinner"></div>
          </div>
        </ng-container>
        <ng-container *ngIf="(success$ | async) as error">
          <img src="assets/img/tick.png" alt="" class="feedback">
        </ng-container>
        <ng-container *ngIf="(backendError$ | async) as error">
          <img src="assets/img/x.png" alt="" class="feedback">
        </ng-container>
      </ng-container>
    </form>
  </div>
  <div class="buttons">
    <div class="logout">
      <button (click)="logOut()" class="button-primary-clear">{{'user.settings.logout-button' | translate}}</button>
    </div>
    <div class="delete">
      <button (click)="tryDeleteAccout()" class="button-primary">{{'user.settings.delete-button' | translate}}</button>
    </div>
  </div>
</div>
<app-dialog 
[title]="'Are you sure you want to delete your account?'"
[body]="'All your teams will be removed'"
[trueButtonText]="'No'"
[falseButtonText]="'Yes'"
[visible]="deleteDialog"
(choose)="chooseEvent($event)"
*ngIf="deleteDialog"
></app-dialog>